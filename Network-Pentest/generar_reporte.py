from fpdf import FPDF
from datetime import datetime

class ReportePentest(FPDF):
    def header(self):
        self.set_font("Arial", "B", 15)
        self.cell(0, 10, "Reporte de Escaneo de Red", border=True, ln=1, align="C")
        self.ln(10)

    def footer(self):
        self.set_y(-15)
        self.set_font("Arial", "I", 8)
        self.cell(0, 10, f"Pagina {self.page_no()}", align="C")

def crear_pdf(nombre_archivo, resultados):
    # --- LA MEJORA EST√Å AQU√ç ---
    # Convertimos a latin-1 e ignoramos lo que no sepa procesar (emojis/s√≠mbolos raros)
    resultados_seguros = resultados.encode('latin-1', 'ignore').decode('latin-1')
    
    pdf = ReportePentest()
    pdf.add_page()
    pdf.set_font("Arial", size=12)
    
    # Metadatos del reporte
    pdf.cell(0, 10, f"Fecha: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}", ln=1)
    pdf.cell(0, 10, f"Analista: Kali User (Ruben)", ln=1)
    pdf.ln(10)
    
    # Contenido del escaneo
    pdf.set_font("Arial", "B", 12)
    pdf.cell(0, 10, "Resultados del Escaneo:", ln=1)
    pdf.set_font("Arial", size=10)
    
    # IMPORTANTE: Usamos 'resultados_seguros' en lugar de 'resultados'
    pdf.multi_cell(0, 10, resultados_seguros)
    
    pdf.output(nombre_archivo)
    print(f"üìÑ Reporte generado con √©xito: {nombre_archivo}")

# Ejemplo de uso
if __name__ == "__main__":
    # Ahora esto no romper√≠a el c√≥digo gracias a la limpieza
    datos_ejemplo = """
    üìç Puerto 80: ABIERTO (HTTP) üöÄ
    ‚ò£Ô∏è Puerto 443: ABIERTO (HTTPS)
    """
    crear_pdf("Reporte_Escaneo.pdf", datos_ejemplo)